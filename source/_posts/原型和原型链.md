---
title: 原型和原型链
date: 2020-03-03 21:38:07
tags:
---

原型和原型链，其实就是由`__proto__` 和 `prototype` 这两个属性组成的链状结构。搞懂了这两个属性，也就搞懂了原型和原型链。

### prototype

JavaScript中的每个函数都拥有prototype这个属性，这个属性指向该函数的原型对象，而以这个函数作为构造函数创建出的实例的原型就是这个原型对象。

实例的原型是什么，每个JavaScript对象在创建时都会有另一个与之关联的对象，这个对象就是原型，对象会从原型上'继承属性'。

举个例子：

```js
function Foo() {}
var f1 = new Foo();
var f2 = new Foo();
Foo.prototype.attr = 'Foo';
console.log(f1.attr);//Foo
console.log(f2.attr);//Foo
```

f1和f2是以Foo作为构造函数创建出的两个实例，它们的原型，也就是函数Foo的原型对象`Foo.prototype`。并且从Foo.prototype上继承了attr这个属性。

![1583246477350](D:\hexo\blog\source\images\1583246477350.png)

Foo.prototype有一个constructor属性，指向这个原型对象对应的构造方法，在原型链中作用不大，就不多说了。

```js
Foo.prototype.constructor === Foo //true
```

prototype用来表示构造函数和原型对象之间的关系，而表现实例和原型之间关系的就是`__proto__` 这个属性。

### `__proto__`

在JavaScript的世界中几乎每个对象都有`__proto__`这个属性，在每个浏览器中我们都可以看到：

```js
f1.__proto__ === Foo.prototype //true
```

我们可以使用这个属性方便的找到或者修改某个对象的原型，所以我们修改以下关系图：

![1583247030442](D:\hexo\blog\source\images\1583247030442.png)



__题外话：__

这个属性其实在ES标准中并不存在，但是浏览器为了方便开发者都不约而同地添加了这个属性。在MDN上也建议不要使用这个属性。

![1583246704220](D:\hexo\blog\source\images\1583246704220.png)

当然，修改对象的原型已经变成了现在前端开发中不可避免地操作，MDN中也写到可以采用以下方法来避免使用`__proto__`这个属性：

![1583246834149](D:\hexo\blog\source\images\1583246834149.png)

### 原型链

```js
function Foo() {}
var f1 = new Foo();
f1.attr = 'f1'
Foo.prototype.attr = 'Foo';
console.log(f1.attr);//f1
delete Foo.prototype.attr;
console.log(f1.attr)//Foo
```

在上面的代码中，获取f1.attr时会先去f1这个对象上寻找attr这个属性，如果找到了，就会直接输出，而如果没有找到，则会去f1的原型上继续寻找，可以看到在最后一行就输出了f1的原型Foo.prototype上的attr属性。

但是如果还没有找到，会怎么办呢？

上面提到了，每个对象都有`__proto__`这个属性，Foo.prototype毫无疑问也是对象，既然是对象，那么我们就可以通过new Object()方法来创建它，所以Foo.prototype的构造函数就是Object，也因此Object.prototype就是Foo.prototype的原型

![1583247666359](D:\hexo\blog\source\images\1583247666359.png)

所以我们就可以继续在Foo.prototype的原型Object.prototype上寻找attr这个属性，如果还没有找到，就继续顺着`__proto__`属性找。

这当然是有个穷尽的，尽头就是Object.prototype的原型null。所以得到的关系图是这样的：

![1583248089112](D:\hexo\blog\source\images\1583248089112.png)

由`__proto__`所连接的关系就是原型链，也就是粉色的这条线。

## 最后

其实关系图还并没有完全补全，因为Foo是函数，也是对象，所以也是有原型的，因此最终的关系图如下：

![1583248560749](D:\hexo\blog\source\images\1583248560749.png)

额，用这种方式画出来好像有点乱。看这张图可能更清楚一点：

![原型和原型链](D:\hexo\blog\source\images\原型和原型链.png)

其中比较奇怪的一点就是Function的prototype和`__proto__`指向同一个对象。



### 参考资料

[JavaScirpt深入之从原型到原型链](https://github.com/mqyqingfeng/Blog/issues/2)

[继承与原型链](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain)

[Object.prototype.__proto__](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/proto)

